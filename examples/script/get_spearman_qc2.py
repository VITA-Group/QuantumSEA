import argparse
import itertools
from scipy import stats


if __name__ == '__main__':
    ground_truth_loss = [
        1.247361211,
        1.261452215,
        1.255187244,
        1.172269599,
        1.286044317,
        1.196596656,
        1.272719775,
        1.221198353,
        1.275246956,
        1.21500645,
        1.209136351,
        1.206317094,
        1.39295565,
        1.233146581,
        1.343352963,
        1.240346464,
        1.410089606,
        1.265338529,
        1.270290867,
        1.277846223,
        1.360241653,
        1.298688154,
        1.261954129,
        1.328886947,
        1.376919466,
        1.317480846,
        1.292976977,
        1.347464051,
        1.38500845,
        1.364810856,
        1.37851152,
        1.378202137,
        1.287533567,
        1.284271629,
        1.184803795,
        1.17159106,
        1.312861105,
        1.285319241,
        1.219116781,
        1.284545662,
        1.324125248,
        1.304296812,
        1.254325355,
        1.395005247,
        1.338429479,
        1.338549988,
        1.287049699,
        1.382790629,
        1.302004375,
        1.307327552,
        1.304831201,
        1.382228094,
        1.384777752,
        1.38354209,
        1.328231251,
        1.393691456,
        1.387699489,
        1.365430566,
        1.323590946,
        1.382303862,
        1.381098763,
        1.4124956,
        1.349107459,
        1.387249287,
    ]

    ground_truth_acc = [
        0.4966666667,
        0.4066666667,
        0.3166666667,
        0.59,
        0.2666666667,
        0.5066666667,
        0.4933333333,
        0.62,
        0.45,
        0.5766666667,
        0.4966666667,
        0.6866666667,
        0.09,
        0.5966666667,
        0.4433333333,
        0.6033333333,
        0.1566666667,
        0.5333333333,
        0.6166666667,
        0.46,
        0.4266666667,
        0.6033333333,
        0.58,
        0.3366666667,
        0.3666666667,
        0.5033333333,
        0.5766666667,
        0.5066666667,
        0.37,
        0.3133333333,
        0.2,
        0.3433333333,
        0.35,
        0.3166666667,
        0.49,
        0.5533333333,
        0.32,
        0.2766666667,
        0.6733333333,
        0.5633333333,
        0.28,
        0.2666666667,
        0.5966666667,
        0.2833333333,
        0.27,
        0.2866666667,
        0.5866666667,
        0.23,
        0.29,
        0.34,
        0.6266666667,
        0.2866666667,
        0.2366666667,
        0.2633333333,
        0.5066666667,
        0.21,
        0.26,
        0.26,
        0.5,
        0.25,
        0.2433333333,
        0.2633333333,
        0.4133333333,
        0.2533333333,
    ]

    succ_all = [
        0.863893077654551,
        0.830013287378712,
        0.862336232558492,
        0.829155454554085,
        0.795153204437956,
        0.765588608376173,
        0.602076416517885,
        0.70204370577252,
        0.618924333225612,
        0.600035277341383,
        0.604330825658903,
        0.613431671236751,
        0.213942915457297,
        0.589899668037133,
        0.444747416622627,
        0.539546900573849,
        0.364748851645136,
        0.434471148756032,
        0.594595765691616,
        0.593043440446794,
        0.203054058747653,
        0.437526727950062,
        0.396825737178193,
        0.399568137240075,
        0.12563275376995,
        0.481668356367737,
        0.426492662336495,
        0.186534164953599,
        0.195505895528277,
        0.373216408936488,
        0.146976902663888,
        0.12832665459602,
        0.904710714481871,
        0.862764647611558,
        0.829601135365364,
        0.688885502833499,
        0.834209743376384,
        0.75734283331488,
        0.699891639734736,
        0.495414991027174,
        0.769202668659271,
        0.664802584066526,
        0.590462436089656,
        0.263157181942178,
        0.709261370021653,
        0.583569892444966,
        0.498142667577899,
        0.157850962246205,
        0.653991089086855,
        0.51226308009379,
        0.420257246007004,
        0.105243454185644,
        0.603027829630638,
        0.449669296899041,
        0.35454933760271,
        0.059452442039241,
        0.556035960393252,
        0.394723891748468,
        0.299114968245962,
        0.0340334866359511,
        0.512706004696035,
        0.346492303992099,
        0.25234785328816,
        0.0209617975315361,
    ]

    noisy_loss_all = [
        1.24343097025733,
        1.21496536761486,
        1.17829107506381,
        1.14115339752817,
        1.25136454954605,
        1.18728434779893,
        1.20168427465108,
        1.15475483422128,
        1.21807802492659,
        1.18273941160192,
        1.20293606473286,
        1.1699586324577,
        1.28659883408818,
        1.22571008911885,
        1.19367146881444,
        1.19603894180688,
        1.24952660278945,
        1.23018704031532,
        1.24078703649127,
        1.22232709000682,
        1.26467377070189,
        1.25385017165323,
        1.24621635357071,
        1.21038169742356,
        1.27319648163253,
        1.27372067665081,
        1.23618702820988,
        1.24025969918596,
        1.28283445876931,
        1.26018134581685,
        1.25543271791302,
        1.25839288850517,
        1.27300200354357,
        1.23056905820883,
        1.15266855917319,
        1.14908312809493,
        1.28063192422946,
        1.23713236820517,
        1.18262226039404,
        1.18056880177475,
        1.28613937940521,
        1.2515736353011,
        1.18984144406842,
        1.23060769679508,
        1.29621037296853,
        1.26336184451153,
        1.18432013127652,
        1.24908115995129,
        1.30354663006268,
        1.27269170804073,
        1.19975075533387,
        1.26797061015358,
        1.31092228870676,
        1.28261697162019,
        1.21280854950673,
        1.29606748405254,
        1.31817421310286,
        1.29050447298981,
        1.22507654336488,
        1.31030633200351,
        1.3250468052641,
        1.29760083768975,
        1.23665572716706,
        1.32652242625871,
    ]

    noisy_acc_all = [
        0.4,
        0.358,
        0.458,
        0.63,
        0.374,
        0.53,
        0.538,
        0.628,
        0.41,
        0.616,
        0.578,
        0.622,
        0.522,
        0.384,
        0.6,
        0.632,
        0.554,
        0.42,
        0.366,
        0.418,
        0.53,
        0.388,
        0.362,
        0.564,
        0.558,
        0.38,
        0.566,
        0.62,
        0.358,
        0.4,
        0.592,
        0.62,
        0.324,
        0.354,
        0.55,
        0.644,
        0.304,
        0.438,
        0.572,
        0.622,
        0.306,
        0.376,
        0.61,
        0.584,
        0.284,
        0.364,
        0.622,
        0.628,
        0.282,
        0.35,
        0.624,
        0.636,
        0.274,
        0.342,
        0.626,
        0.596,
        0.278,
        0.34,
        0.624,
        0.632,
        0.27,
        0.34,
        0.628,
        0.564,
    ]

    noise_free_acc_all = [
        0.348142164781906,
        0.337641357027464,
        0.522617124394184,
        0.65670436187399,
        0.378029079159935,
        0.559773828756058,
        0.606623586429725,
        0.632471728594507,
        0.555735056542811,
        0.661550888529887,
        0.605815831987076,
        0.652665589660743,
        0.421647819063005,
        0.516155088852989,
        0.604200323101777,
        0.61389337641357,
        0.566235864297254,
        0.57108239095315,
        0.398222940226171,
        0.47092084006462,
        0.5718901453958,
        0.549273021001616,
        0.425686591276252,
        0.573505654281099,
        0.606623586429725,
        0.466882067851373,
        0.608239095315024,
        0.61470113085622,
        0.419224555735057,
        0.520193861066236,
        0.584006462035541,
        0.638933764135703,
        0.324717285945073,
        0.334410339256866,
        0.599353796445881,
        0.658319870759289,
        0.333602584814216,
        0.493537964458805,
        0.563004846526656,
        0.617932148626817,
        0.348949919224556,
        0.426494345718901,
        0.635702746365105,
        0.616316639741519,
        0.337641357027464,
        0.403877221324717,
        0.630856219709208,
        0.641357027463651,
        0.365912762520194,
        0.410339256865913,
        0.637318255250404,
        0.655896607431341,
        0.358642972536349,
        0.410339256865913,
        0.627625201938611,
        0.634087237479806,
        0.3578352180937,
        0.409531502423263,
        0.62924071082391,
        0.634087237479806,
        0.361066235864297,
        0.411147011308562,
        0.627625201938611,
        0.639741518578352,
    ]

    noise_free_loss_all = [
        1.21333611011505,
        1.180699467659,
        1.12668871879578,
        1.0796719789505,
        1.20788836479187,
        1.11494600772858,
        1.12333297729492,
        1.06941151618958,
        1.14656043052673,
        1.08664238452911,
        1.12716972827911,
        1.0684814453125,
        1.21376967430115,
        1.13569569587708,
        1.06974458694458,
        1.09157299995422,
        1.14647161960602,
        1.11350250244141,
        1.15041995048523,
        1.12668335437775,
        1.13123786449432,
        1.14583718776703,
        1.12601661682129,
        1.0647474527359,
        1.10141050815582,
        1.16587615013123,
        1.11755573749542,
        1.06499469280243,
        1.16660845279694,
        1.13515150547028,
        1.06886672973633,
        1.04800641536713,
        1.24353075027466,
        1.19505429267883,
        1.09572803974152,
        1.07864570617676,
        1.23867666721344,
        1.18281507492065,
        1.11299860477448,
        1.08004772663116,
        1.23259282112122,
        1.18434548377991,
        1.09926521778107,
        1.10348212718964,
        1.23702597618103,
        1.18701171875,
        1.0664849281311,
        1.09948468208313,
        1.23201143741608,
        1.18194329738617,
        1.06496214866638,
        1.10089600086212,
        1.23222410678864,
        1.18416094779968,
        1.06504607200623,
        1.10434591770172,
        1.23221135139465,
        1.18298137187958,
        1.06553900241852,
        1.10398101806641,
        1.23213624954224,
        1.18161749839783,
        1.06504571437836,
        1.10468351840973,
    ]



    # parser = argparse.ArgumentParser()
    # parser.add_argument('--supernet', type=str)
    # parser.add_argument('--gpu', type=int)
    # args = parser.parse_args()
    # print(args.supernet)
    #
    # cnt = 0
    # loss_all = []
    # with open(f'logs/super/eval_subnet_noise_x2_opt2_ratiorand_'
    #           f'insuper_{args.supernet}.txt',
    #           'r') as rfid:
    # # with open(f'logs/super/eval_subnet_tq_ratiorand_'
    # #           f'insuper_{args.supernet}.txt',
    # #           'r') as rfid:
    #     for line in rfid:
    #         if 'Loss' in line:
    #             cnt += 1
    #             if cnt % 2:
    #                 loss_all.append(eval(line.split(' ')[-1]))

    loss_all = [noise_free_acc_all[k] * succ_all[k] for k in range(len(
        noise_free_loss_all))]

    # corrects = 0
    # cnt = 0
    # for comb in itertools.combinations_with_replacement(
    #         list(range(len(ground_truth_loss))), 2):
    #
    #     a = ground_truth_loss[comb[0]]
    #     b = ground_truth_loss[comb[1]]
    #     a_est = loss_all[comb[0]]
    #     b_est = loss_all[comb[1]]
    #     # if a < 0.5 or b < 0.5:
    #     #     continue
    #     cnt += 1
    #     if not (a >= b) ^ (a_est >= b_est):
    #         corrects += 1

    rho, p = stats.spearmanr(ground_truth_loss, noisy_loss_all)

    print(f"spearman rho {rho}, p {p}")
